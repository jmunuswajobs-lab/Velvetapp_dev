PROFESSIONAL CUP PONG REIMPLEMENTATION

You are Replit‚Äôs principal game UI + realtime engineer working in this repo:

https://github.com/jmunuswajobs-lab/Velvetapp_dev

Game in focus:

Emotion Ping Pong ‚Äî now intended to be a Beer Pong / Cup Pong‚Äìstyle game.

Current implementation problems (to FIX):

The board is a flat rounded rectangle with a weird vertical stack of rectangles instead of a triangular cup rack.

The composition doesn‚Äôt resemble a Beer Pong table (no perspective, no sense of depth).

Aim/power controls feel like debug sliders, not natural game controls.

The overall UX feels like a prototype, not a finished mini-game.

Your job:

üî¥ Rebuild Emotion Ping Pong into a professional-quality, GamePigeon-like Cup Pong experience with:

Clean, 3D-ish table and cup visuals

Proper triangular cup racks

Swipe/drag aiming + power controls

Smooth ball arc & cup hit animations

Correct use of existing Beer Pong game APIs (no new backend unless strictly necessary)

Mobile-first layout that feels polished

No placeholders. No temporary ‚Äúdebug‚Äù sliders. This must feel shippable.

1Ô∏è‚É£ Use Existing Beer Pong State & APIs (Don‚Äôt Throw Them Away)

Locate all code related to Emotion Ping Pong / Beer Pong:

Backend:

Any game-engine file (beerPongEngine, emotionPongEngine, etc.)

GameSession handling for this game.

WebSocket events (take_shot, beer_pong_action, etc.).

Frontend:

Emotion Ping Pong route/page (games/emotion-ping-pong/play).

The current Beer Pong UI component(s) (table + sliders + THROW button).

Any Zustand/Redux store or hooks used for this game.

Keep the backend API shape as much as possible:

Keep the same actions for ‚Äútake shot‚Äù and ‚Äúsession update‚Äù.

Keep the game state fields (remaining cups, whose turn, etc.) unless truly broken.

If you must change them, do so once, clearly, and update all consumers.

Clearly document in comments:

What state fields the frontend relies upon.

What WS actions are sent/received for this game.

2Ô∏è‚É£ New Component: BeerPongGameScreen

Create a dedicated React component for this game:

client/src/games/BeerPongGameScreen.tsx

This component will be the only gameplay view for Emotion Ping Pong.

Bind to route

Update the routing / Gameplay switch so that:

When game.slug === "emotion-ping-pong" or engineType === "beer-pong",

We render <BeerPongGameScreen session={session} /> instead of the old UI.

Remove or stop using the rectangular ‚Äústack of cups + sliders‚Äù component.

3Ô∏è‚É£ Visual Design ‚Äî Make It Look Like Real Cup Pong

Design constraints:

Perspective table, not a flat rectangle:

Use CSS transforms (transform: perspective(...) rotateX(...)) or an SVG/trapezoid to suggest depth.

Keep a 16:9-ish table area, centered on screen.

Table

Surface color: rich green (pool-table vibe) or a branded neon green; add subtle noise or gradient.

White center line.

Edge: subtle bevel or border to suggest thickness.

Optional: super soft drop shadow underneath.

Cups

Circular tops (ellipses in perspective), not squares.

Body as a cylinder:

Gradient from mid-tone to darker at bottom for depth.

Color: e.g., bright magenta or blue that matches brand; ensure contrast with table.

Each cup has:

Top ellipse

Rectangular body

Soft shadow on the table behind/below.

Cup layout

Opponent rack: triangular arrangement near the far end:

For 6 cups: 3-2-1 triangle.

For 10: 4-3-2-1 triangle.

Keep cups centered horizontally; slight perspective scaling (back row slightly smaller).

Ball

Small circle with highlight + subtle shadow.

Appears from the near end of the table, travels in an arcing motion.

Use Framer Motion or CSS animations for:

Cup hit (shake + fade/scale out).

Ball flight (x/y/scale, maybe opacity).

4Ô∏è‚É£ Layout & HUD

Layout the screen like this:

Top bar (fixed height):

Left: local player avatar + name + ‚ÄúX cups left‚Äù.

Center: score like You 6 ‚Äî 6 Opponent.

Right: opponent avatar + name + ‚ÄúX cups left‚Äù.

Middle:

Main table and cup rack.

When waiting:

Center overlay: ‚ÄúWaiting for opponent‚Ä¶‚Äù (semi-transparent panel over table).

When active:

Optional subtle hint: ‚ÄúSwipe up to aim and release to throw‚Äù.

Bottom:

For mobile:

Thin bar showing:

Current turn (‚ÄúYour turn‚Äù / ‚ÄúOpponent‚Äôs turn‚Äù).

Small icons/buttons: exit, sound toggle, etc.

Remove the giant aim/power sliders ‚Äî replace with swipe/drag controls.

5Ô∏è‚É£ Aiming & Power Controls (Swipe/Drag)

Implement gesture-based controls to feel like Cup Pong:

On the table area:

When it is your turn:

Player touches near the bottom edge of the table and swipes up.

Horizontal offset of swipe ‚Üí aim (left/right).

Swipe length + speed ‚Üí power.

Implement:

interface ShotInput {
  angle: number;  // degrees or radians (left/right)
  power: number;  // normalized 0‚Äì1
}


Steps:

On pointerdown / touchstart:

Store starting position.

On pointerup / touchend:

Compute:

deltaX = end.x - start.x

deltaY = start.y - end.y (upwards swipe)

Derive:

angle = clamp(deltaX * ANGLE_FACTOR, MIN_ANGLE, MAX_ANGLE)

power = clamp(deltaY * POWER_FACTOR, 0, 1)

If power below small threshold ‚Üí ignore (no accidental flicks).

Send a TAKE_SHOT action using existing WS API, including angle+power (if backend can accept them) or mapping them to whatever fields server expects.

Disable further throws until server responds with updated state.

6Ô∏è‚É£ Ball Animation & Hit Feedback

Client-side ball animation:

Once a shot gesture is completed, immediately start animating a ball from near bottom of table along a parabolic arc:

Use a small physics helper:

t goes 0 ‚Üí 1 over ~700‚Äì900 ms.

x(t) interpolates based on angle.

y(t) moves from near player to opponent cups.

height(t) uses a simple parabola for vertical arc (for shadow scale/opacities).

Show a shadow under the ball that grows smaller as it approaches the farther end.

Server result integration:

Backend decides hit/miss and which cup (as it already does).

When state update arrives:

If hit and a cupId is returned:

Identify that cup in client layout.

Trigger a ‚Äúhit‚Äù animation:

Quick scale up + rotation wiggle.

Fade to 0 and remove from state.

If miss:

Nothing changes; maybe show a small ‚ÄúMISS‚Äù label at top for a second.

Ensure that ball animation concludes even if server message arrives quickly; avoid visual popping.

7Ô∏è‚É£ Turn Logic & Realtime Sync

Using the existing session state:

Show whose turn it is clearly:

Bold/colored nickname on the HUD.

Dim the inactive player.

Client rules:

Local player can only initiate a shot if:

session.currentPlayerId === localPlayerId.

Game not finished.

Opponent‚Äôs turn:

Ignore swipe gestures for shooting.

Only animate ball & cups based on server updates.

Reconnection:

On reload:

Fetch session state.

Rebuild table + cups from state (remaining cups and positions).

Do not replay previous shots; just show current state.

8Ô∏è‚É£ Remove Old Beer Pong UI + Dead Code

Remove or de-register the old Beer Pong / Emotion Ping Pong UI that used:

Flat rectangular ‚Äúcups‚Äù.

Aim + Power plain sliders.

THROW button as only interaction.

Ensure there is exactly one UI implementation for this game: BeerPongGameScreen.

Clean up unused CSS/JS to avoid confusion.

9Ô∏è‚É£ QA Checklist (Mandatory Before Stopping)

From two different browser tabs (or devices), run through these scenarios:

Start a new Emotion Ping Pong game online:

Both players see the new table, cups in triangular rack, and avatars.

If one player joins first, they see a center ‚ÄúWaiting for opponent‚Ä¶‚Äù message.

Take turns shooting:

On your turn, swiping up causes the ball to animate.

Cups disappear on hit with nice animation.

Scores / ‚ÄúX cups left‚Äù update correctly on both sides.

Edge cases:

Extremely small swipe ‚Üí no shot.

Rapid repeated swipes ‚Üí only one request is sent until state update.

Reload tab mid-game ‚Üí state rehydrates and UI renders correctly.

End of game:

When one side‚Äôs cups = 0:

Show a clear ‚ÄúYou Win‚Äù / ‚ÄúYou Lose‚Äù modal or banner.

Provide buttons: ‚ÄúPlay again‚Äù and ‚ÄúExit to lobby‚Äù.

Technical:

No runtime errors in browser console.

No unhandled promise rejections.

TypeScript build passes with 0 errors.

WebSocket remains stable, no spam reconnections.

üîö Final Response From You (Replit)

After implementing, respond with:

Files created/modified (especially BeerPongGameScreen, engine integration, routing).

How gestures map to angle/power numerically.

Any configuration constants (cup count, table size, aim sensitivity) and where to tweak them.